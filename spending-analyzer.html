<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Domus â€“ Spending Analyzer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="spending-analyzer.css">
</head>

<body>

    <!-- â”€â”€ Header (matches main app) â”€â”€ -->
    <header class="header">
        <div class="main-header">
            <h2 class="topheader">
                <a class="logo" href="index.html">Domus</a>
            </h2>
        </div>
        <nav class="centertabs">
            <ul class="other_tabs1">
                <li class="tab" onclick="window.location='index.html?page=banks'">Banks</li>
                <li class="tab" onclick="window.location='index.html?page=groceries'">Groceries</li>
                <li class="tab" onclick="window.location='index.html?page=school'">School</li>
                <li class="tab active" onclick="window.location='spending-analyzer.html'">Spending Analyzer</li>
                <li class="tab" onclick="window.location='index.html?page=utilities'">Utilities</li>
                <li class="tab" onclick="window.location='index.html?page=work'">Work</li>
                <li class="tab" onclick="window.location='chatbot.html'">Chatbot</li>
            </ul>
        </nav>
        <button id="theme-btn" class="theme-toggle-btn" onclick="ThemeToggle.toggle()" title="Switch to dark mode">&#127769;</button>
    <button class="header-chat-btn" onclick="ChatWidget.toggle()">&#x1F4AC; <span>Ask Domus</span></button>
    </header>

    <main class="sa-main">

        <!-- â”€â”€ Hero â”€â”€ -->
        <section class="sa-hero">
            <div class="sa-badge">AI-Powered &nbsp;&middot;&nbsp; Live Insights</div>
            <h1 class="sa-title">Domus</h1>
            <p class="sa-subtitle">Real-time spending insights and personalized financial intelligence</p>
        </section>

        <!-- â”€â”€ Dashboard â”€â”€ -->
        <div id="dashboard" class="sa-dashboard">

            <!-- Filter Bar -->
            <div class="sa-filter-bar">
                <span class="sa-filter-label">Showing last:</span>
                <div class="sa-filter-btns" id="filter-section">
                    <button class="sa-filter-btn" onclick="switchPeriod(7,  this)">7 days</button>
                    <button class="sa-filter-btn sa-filter-active" onclick="switchPeriod(30, this)">30 days</button>
                    <button class="sa-filter-btn" onclick="switchPeriod(60, this)">60 days</button>
                    <button class="sa-filter-btn" onclick="switchPeriod(90, this)">90 days</button>
                </div>
                <span class="sa-demo-badge">ğŸ“Š Demo Data</span>
            </div>

            <!-- Summary Cards -->
            <div id="summary-cards" class="sa-summary-grid">
                <div class="sa-stat-card">
                    <div class="sa-stat-label">Total Spent</div>
                    <div id="card-spent" class="sa-stat-value sa-val-red">â€”</div>
                    <div class="sa-stat-sub">this period</div>
                </div>
                <div class="sa-stat-card">
                    <div class="sa-stat-label">Daily Average</div>
                    <div id="card-avg" class="sa-stat-value sa-val-blue">â€”</div>
                    <div class="sa-stat-sub">per day</div>
                </div>
                <div class="sa-stat-card">
                    <div class="sa-stat-label">Top Category</div>
                    <div id="card-cat" class="sa-stat-value sa-val-purple">â€”</div>
                    <div class="sa-stat-sub">highest spend</div>
                </div>
                <div class="sa-stat-card">
                    <div class="sa-stat-label">Transactions</div>
                    <div id="card-count" class="sa-stat-value sa-val-green">â€”</div>
                    <div class="sa-stat-sub">total count</div>
                </div>
            </div>

            <!-- Mid Row: Category Breakdown + AI Report -->
            <div class="sa-two-col">
                <div id="breakdown-section" class="sa-panel">
                    <h3 class="sa-panel-title">ğŸ“Š Spending by Category</h3>
                    <div id="breakdown-bars"><p class="sa-loading">Loading categoriesâ€¦</p></div>
                </div>
                <div id="recs-section" class="sa-panel">
                    <h3 class="sa-panel-title">ğŸ’¡ AI Recommendations</h3>
                    <div id="recs-list"><p class="sa-loading">Generating AI reportâ€¦</p></div>
                </div>
            </div>

            <!-- Transactions Table -->
            <div id="tx-section" class="sa-panel">
                <div class="sa-panel-header">
                    <h3 class="sa-panel-title">ğŸ’³ Recent Transactions</h3>
                    <span id="tx-total" class="sa-tx-count"></span>
                </div>
                <div id="tx-list"><p class="sa-loading">Loading transactionsâ€¦</p></div>
                <button id="load-more-btn" class="sa-load-more" style="display:none;" onclick="loadMore()">
                    Load More Transactions
                </button>
            </div>

            <!-- Bottom Row: Recurring + Anomalies -->
            <div class="sa-two-col">
                <div id="recurring-section" class="sa-panel">
                    <h3 class="sa-panel-title">ğŸ” Recurring Transactions</h3>
                    <p class="sa-panel-sub">Merchants appearing in 2+ months â€” likely subscriptions or habits.</p>
                    <div id="recurring-list"><p class="sa-loading">Detecting patternsâ€¦</p></div>
                </div>
                <div id="anomalies-section" class="sa-panel">
                    <h3 class="sa-panel-title">âš ï¸ Spending Anomalies</h3>
                    <p class="sa-panel-sub">Transactions more than 2Ã— the average for their category.</p>
                    <div id="anomalies-list"><p class="sa-loading">Scanning anomaliesâ€¦</p></div>
                </div>
            </div>

            <!-- AI Chat -->
            <div id="chat-section" class="sa-panel sa-chat-panel">
                <h3 class="sa-panel-title">ğŸ’¬ Ask Domus</h3>
                <p class="sa-panel-sub">Ask anything about your spending and get personalised AI insights.</p>
                <div id="chat-output" class="sa-chat-output"></div>
                <div class="sa-chat-input-row">
                    <input
                        id="chat-input"
                        class="sa-chat-input"
                        type="text"
                        placeholder="e.g. Where am I overspending this month?"
                    />
                    <button class="sa-chat-send" onclick="sendChat()">Send â†‘</button>
                </div>
            </div>

        </div><!-- /dashboard -->

        <!-- Error Box -->
        <div id="error-box" class="sa-error-box" style="display:none;"></div>

    </main>

    <footer>
        <p>&copy; 2026 <strong>Domus</strong> &mdash; Spending Analyzer &middot; Fiserv Future Techies Challenge</p>
    </footer>

    <!-- plaid.js after DOM so IDs exist -->
    <script src="plaid.js"></script>

    <script>
        // Period switcher
        function switchPeriod(days, btn) {
            document.querySelectorAll('.sa-filter-btn')
                    .forEach(b => b.classList.remove('sa-filter-active'));
            btn.classList.add('sa-filter-active');
            loadTransactions(days);
        }

        // Allow pressing Enter in chat
        document.addEventListener('DOMContentLoaded', () => {
            const inp = document.getElementById('chat-input');
            if (inp) inp.addEventListener('keydown', e => {
                if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendChat(); }
            });

            // Auto-load data on page ready (no bank sign-in needed)
            loadTransactions(30);
        });
    </script>

</body>
</html>
